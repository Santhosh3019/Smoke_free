<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoke-Free Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
        }
        .marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 25s linear infinite;
        }
        @keyframes marquee {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        /* Professional scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #4A5568;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-gray-900 text-slate-200 antialiased">

    <!-- Main Container -->
    <div id="app-container" class="min-h-screen max-w-lg mx-auto p-4 flex flex-col fade-in">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-6 pb-4 border-b border-slate-700/50">
            <h1 class="text-2xl font-bold text-cyan-400 tracking-wide" data-translate="appTitle">Smoke-Free Journey</h1>
            <button id="language-switcher" class="px-3 py-1 text-sm font-semibold bg-slate-800 rounded-full hover:bg-slate-700 transition-colors shadow-md">à®¤à®®à®¿à®´à¯</button>
        </header>

        <!-- Initial Setup Screen -->
        <div id="setup-screen" class="flex-grow flex flex-col justify-center items-center text-center p-4">
            <div class="w-full bg-slate-800/50 p-8 rounded-2xl shadow-2xl">
                <h2 class="text-3xl font-bold mb-2" data-translate="welcomeTitle">Welcome!</h2>
                <p class="text-slate-400 mb-8" data-translate="welcomeSubtitle">Let's start your journey to a smoke-free life.</p>
                <form id="setup-form" class="space-y-6">
                    <label for="initial-cigarettes" class="block text-lg font-medium mb-2" data-translate="initialCigarettesLabel">How many cigarettes do you smoke per day?</label>
                    <input type="number" id="initial-cigarettes" class="w-full bg-slate-900 border-2 border-slate-700 text-white text-center text-3xl rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="e.g., 15" required min="1">
                    <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 shadow-lg shadow-cyan-500/20" data-translate="startButton">Start Journey</button>
                </form>
            </div>
        </div>

        <!-- Main App Screen (hidden by default) -->
        <div id="main-screen" class="hidden flex-grow flex flex-col">
            <!-- Dashboard -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-center">
                <div class="bg-slate-800/70 p-4 rounded-xl shadow-lg flex items-center justify-center space-x-4">
                    <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <div>
                        <p class="text-sm text-slate-400" data-translate="todaysTarget">Today's Target</p>
                        <p id="target-count" class="text-4xl font-bold text-green-400">14</p>
                    </div>
                </div>
                <div class="bg-slate-800/70 p-4 rounded-xl shadow-lg flex items-center justify-center space-x-4">
                     <svg class="w-8 h-8 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.657 7.343A8 8 0 0117.657 18.657z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.343 17.657a8 8 0 0110.607-10.607L15 12l-4.657 5.657z"></path></svg>
                    <div>
                        <p class="text-sm text-slate-400" data-translate="smokedToday">Smoked Today</p>
                        <p id="smoked-count" class="text-4xl font-bold">0</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mb-6 space-y-3">
                <button id="smoked-button" class="w-full bg-gradient-to-r from-rose-600 to-red-600 hover:from-rose-700 hover:to-red-700 text-white font-bold py-4 px-4 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg shadow-red-500/20" data-translate="smokedButton">I Smoked a Cigarette</button>
                <div id="limit-reached-controls" class="hidden grid grid-cols-2 gap-3">
                    <button id="limit-reached-button" class="w-full bg-slate-800 text-amber-400 font-bold py-3 px-4 rounded-lg text-sm text-center shadow-md"></button>
                    <button id="urge-button" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg text-sm text-center shadow-lg shadow-cyan-500/20" data-translate="urgeButton">Had an Urge?</button>
                </div>
            </div>
            
            <!-- Running Message -->
            <div class="bg-slate-800/50 rounded-lg p-2 mb-6 marquee-container shadow-md">
                 <p id="running-message" class="text-cyan-300 text-sm marquee-text"></p>
            </div>

            <!-- Progress Log -->
            <div class="flex-grow bg-slate-800/50 rounded-xl p-4 overflow-y-auto shadow-inner">
                <h3 class="text-lg font-bold mb-4 text-slate-300" data-translate="progressLogTitle">Progress Log</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-400 uppercase">
                            <tr>
                                <th scope="col" class="py-3 px-2" data-translate="dateHeader">Date</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="targetHeader">Target</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="smokedHeader">Smoked</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="statusHeader">Status</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table-body" class="divide-y divide-slate-700/50"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Congratulations Screen -->
        <div id="congrats-screen" class="hidden flex-grow flex flex-col justify-center items-center text-center p-4">
             <div class="text-7xl mb-4">ğŸ‰</div>
             <h2 class="text-4xl font-bold text-green-400 mb-2" data-translate="congratsTitle">Congratulations!</h2>
             <p class="text-slate-300 mb-8 max-w-md" data-translate="congratsSubtitle">You have completed your journey and are now smoke-free! We are proud of you.</p>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="motivation-modal" class="fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto text-center modal-content transform scale-95 shadow-2xl border border-slate-700">
             <div class="text-5xl mb-4">ğŸŒŸ</div>
            <h3 class="text-xl font-bold mb-4 text-green-400" data-translate="motivationTitle">Great Job Yesterday!</h3>
            <p id="motivation-quote" class="text-slate-300 italic mb-6">"The secret of getting ahead is getting started."</p>
            <button onclick="closeModal('motivation-modal')" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="motivationKeepGoingButton">Keep Going!</button>
        </div>
    </div>

    <div id="urge-modal" class="fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto text-center modal-content transform scale-95 shadow-2xl border border-slate-700">
             <div class="text-5xl mb-4">ğŸ’ª</div>
            <h3 class="text-xl font-bold mb-4 text-cyan-400" data-translate="urgeTitle">Stay Strong!</h3>
            <p id="urge-quote" class="text-slate-300 mb-6">"A craving is just a thought. You are in control, not the thought."</p>
            <button onclick="closeModal('urge-modal')" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="urgeCloseButton">I Can Do This!</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const setupScreen = document.getElementById('setup-screen');
        const mainScreen = document.getElementById('main-screen');
        const congratsScreen = document.getElementById('congrats-screen');
        const setupForm = document.getElementById('setup-form');
        const initialCigarettesInput = document.getElementById('initial-cigarettes');
        const languageSwitcher = document.getElementById('language-switcher');
        const targetCountEl = document.getElementById('target-count');
        const smokedCountEl = document.getElementById('smoked-count');
        const smokedButton = document.getElementById('smoked-button');
        const limitReachedControls = document.getElementById('limit-reached-controls');
        const limitReachedButton = document.getElementById('limit-reached-button');
        const urgeButton = document.getElementById('urge-button');
        const runningMessageEl = document.getElementById('running-message');
        const progressTableBody = document.getElementById('progress-table-body');
        
        const motivationModal = document.getElementById('motivation-modal');
        const motivationQuoteEl = document.getElementById('motivation-quote');
        const urgeModal = document.getElementById('urge-modal');
        const urgeQuoteEl = document.getElementById('urge-quote');

        // --- App State ---
        let state = { language: 'en', plan: [], startDate: null, initialCount: 0, lastCheckedDate: null };
        let countdownInterval = null;
        let lastUrgeTipIndex = -1;
        
        // --- Translations, Quotes & Messages ---
        const translations = {
            en: {
                appTitle: "Smoke-Free Journey",
                welcomeTitle: "Welcome!",
                welcomeSubtitle: "Let's start your journey to a smoke-free life.",
                initialCigarettesLabel: "How many cigarettes do you smoke per day?",
                startButton: "Start Journey",
                todaysTarget: "Today's Target",
                smokedToday: "Smoked Today",
                smokedButton: "I Smoked a Cigarette",
                progressLogTitle: "Progress Log",
                dateHeader: "Date",
                targetHeader: "Target",
                smokedHeader: "Smoked",
                statusHeader: "Status",
                motivationTitle: "Great Job Yesterday!",
                motivationKeepGoingButton: "Keep Going!",
                congratsTitle: "Congratulations!",
                congratsSubtitle: "You have completed your journey and are now smoke-free! We are proud of you.",
                runningMessage: "Don't be a slave to a stick of paper and leaves. Break the chains with every craving you conquer.",
                urgeButton: "Had an Urge?",
                urgeTitle: "Stay Strong!",
                urgeCloseButton: "I Can Do This!",
                limitReachedText: "Next in <span id='countdown-timer' class='text-white'>--:--:--</span>",
                urgeTips: [
                    "Take a deep breath and a sip of cold water. Wait 5 minutes, the feeling will pass.",
                    "Eat something you like! A healthy snack can distract you and satisfy cravings.",
                    "Successful people are self-controlled. If you can control this, you can achieve anything.",
                    "Think about why you started. Don't give up on that goal now.",
                    "Go for a short walk. Changing your environment can break the craving cycle.",
                    "Chew on some sugar-free gum or a healthy snack. The act of chewing can relieve stress.",
                    "Listen to your favorite song. Music can instantly lift your mood and distract you from cravings.",
                    "Text or call a friend or family member for support. A quick chat can make a big difference.",
                    "Remind yourself of the money you're saving. Think about what you can buy with it.",
                    "Play a quick game on your phone. Engaging your mind can help the craving pass."
                ],
                statusPass: "Pass",
                statusFail: "Fail",
                statusPending: "Pending",
                statusWaiting: "Wait"
            },
            ta: {
                appTitle: "à®ªà¯à®•à¯ˆà®ªà¯à®ªà®¿à®Ÿà®¿à®•à¯à®•à®¾à®¤ à®ªà®¯à®£à®®à¯",
                welcomeTitle: "à®µà®¾à®°à¯à®™à¯à®•à®³à¯!",
                welcomeSubtitle: "à®ªà¯à®•à¯ˆà®¯à®±à¯à®± à®µà®¾à®´à¯à®•à¯à®•à¯ˆà®¯à¯ˆ à®¨à¯‹à®•à¯à®•à®¿à®¯ à®‰à®™à¯à®•à®³à¯ à®ªà®¯à®£à®¤à¯à®¤à¯ˆà®¤à¯ à®¤à¯Šà®Ÿà®™à¯à®•à¯à®µà¯‹à®®à¯.",
                initialCigarettesLabel: "à®’à®°à¯ à®¨à®¾à®³à¯ˆà®•à¯à®•à¯ à®à®¤à¯à®¤à®©à¯ˆ à®šà®¿à®•à®°à¯†à®Ÿà¯ à®ªà¯à®•à¯ˆà®•à¯à®•à®¿à®±à¯€à®°à¯à®•à®³à¯?",
                startButton: "à®ªà®¯à®£à®¤à¯à®¤à¯ˆà®¤à¯ à®¤à¯Šà®Ÿà®™à¯à®•à¯",
                todaysTarget: "à®‡à®©à¯à®±à¯ˆà®¯ à®‡à®²à®•à¯à®•à¯",
                smokedToday: "à®‡à®©à¯à®±à¯ à®ªà¯à®•à¯ˆà®¤à¯à®¤à®¤à¯",
                smokedButton: "à®¨à®¾à®©à¯ à®’à®°à¯ à®šà®¿à®•à®°à¯†à®Ÿà¯ à®ªà®¿à®Ÿà®¿à®¤à¯à®¤à¯‡à®©à¯",
                progressLogTitle: "à®®à¯à®©à¯à®©à¯‡à®±à¯à®±à®ªà¯ à®ªà®¤à®¿à®µà¯",
                dateHeader: "à®¤à¯‡à®¤à®¿",
                targetHeader: "à®‡à®²à®•à¯à®•à¯",
                smokedHeader: "à®ªà¯à®•à¯ˆà®¤à¯à®¤à®¤à¯",
                statusHeader: "à®¨à®¿à®²à¯ˆ",
                motivationTitle: "à®¨à¯‡à®±à¯à®±à¯ à®šà®¿à®±à®ªà¯à®ªà®¾à®• à®šà¯†à®¯à¯à®¤à¯€à®°à¯à®•à®³à¯!",
                motivationKeepGoingButton: "à®¤à¯Šà®Ÿà®°à¯à®¨à¯à®¤à¯ à®®à¯à®©à¯à®©à¯‡à®±à¯!",
                congratsTitle: "à®µà®¾à®´à¯à®¤à¯à®¤à¯à®•à¯à®•à®³à¯!",
                congratsSubtitle: "à®‰à®™à¯à®•à®³à¯ à®ªà®¯à®£à®¤à¯à®¤à¯ˆ à®µà¯†à®±à¯à®±à®¿à®•à®°à®®à®¾à®• à®®à¯à®Ÿà®¿à®¤à¯à®¤à¯à®µà®¿à®Ÿà¯à®Ÿà¯€à®°à¯à®•à®³à¯, à®‡à®ªà¯à®ªà¯‹à®¤à¯ à®¨à¯€à®™à¯à®•à®³à¯ à®ªà¯à®•à¯ˆà®ªà¯à®ªà®¿à®Ÿà®¿à®•à¯à®•à®¾à®¤à®µà®°à¯! à®‰à®™à¯à®•à®³à¯ˆ à®¨à®¿à®©à¯ˆà®¤à¯à®¤à¯ à®¨à®¾à®™à¯à®•à®³à¯ à®ªà¯†à®°à¯à®®à¯ˆà®ªà¯à®ªà®Ÿà¯à®•à®¿à®±à¯‹à®®à¯.",
                runningMessage: "à®’à®°à¯ à®•à®¾à®•à®¿à®¤à®¤à¯à®¤à®¿à®±à¯à®•à¯à®®à¯ à®‡à®²à¯ˆà®•à®³à¯à®•à¯à®•à¯à®®à¯ à®…à®Ÿà®¿à®®à¯ˆà®¯à®¾à®• à®‡à®°à¯à®•à¯à®•à®¾à®¤à¯€à®°à¯à®•à®³à¯. à®¨à¯€à®™à¯à®•à®³à¯ à®µà¯†à®²à¯à®²à¯à®®à¯ à®’à®µà¯à®µà¯Šà®°à¯ à®à®•à¯à®•à®¤à¯à®¤à¯à®Ÿà®©à¯à®®à¯ à®šà®™à¯à®•à®¿à®²à®¿à®•à®³à¯ˆ à®‰à®Ÿà¯ˆà®•à¯à®•à®µà¯à®®à¯.",
                urgeButton: "à®’à®°à¯ à®†à®šà¯ˆà®¯à®¾?",
                urgeTitle: "à®¤à®¿à®Ÿà®®à®¾à®• à®‡à®°à¯à®™à¯à®•à®³à¯!",
                urgeCloseButton: "à®à®©à¯à®©à®¾à®²à¯ à®®à¯à®Ÿà®¿à®¯à¯à®®à¯!",
                limitReachedText: "à®…à®Ÿà¯à®¤à¯à®¤à¯ <span id='countdown-timer' class='text-white'>--:--:--</span>",
                urgeTips: [
                    "à®†à®´à¯à®¨à¯à®¤ à®®à¯‚à®šà¯à®šà¯ à®µà®¿à®Ÿà¯à®™à¯à®•à®³à¯, à®•à¯à®³à®¿à®°à¯ à®¨à¯€à®°à¯ à®•à¯à®Ÿà®¿à®¯à¯à®™à¯à®•à®³à¯. 5 à®¨à®¿à®®à®¿à®Ÿà®™à¯à®•à®³à¯ à®•à®¾à®¤à¯à®¤à®¿à®°à¯à®™à¯à®•à®³à¯, à®…à®¨à¯à®¤ à®‰à®£à®°à¯à®µà¯ à®•à®Ÿà®¨à¯à®¤à¯ à®ªà¯‹à®•à¯à®®à¯.",
                    "à®‰à®™à¯à®•à®³à¯à®•à¯à®•à¯à®ªà¯ à®ªà®¿à®Ÿà®¿à®¤à¯à®¤ à®’à®©à¯à®±à¯ˆà®šà¯ à®šà®¾à®ªà¯à®ªà®¿à®Ÿà¯à®™à¯à®•à®³à¯! à®’à®°à¯ à®šà®¿à®±à¯à®±à¯à®£à¯à®Ÿà®¿ à®‰à®™à¯à®•à®³à¯ à®•à®µà®©à®¤à¯à®¤à¯ˆ à®¤à®¿à®šà¯ˆ à®¤à®¿à®°à¯à®ªà¯à®ªà¯à®®à¯.",
                    "à®µà¯†à®±à¯à®±à®¿à®¯à®¾à®³à®°à¯à®•à®³à¯ à®¤à®©à¯à®©à®Ÿà®•à¯à®•à®®à¯ à®•à¯Šà®£à¯à®Ÿà®µà®°à¯à®•à®³à¯. à®‡à®¤à¯ˆ à®‰à®™à¯à®•à®³à®¾à®²à¯ à®•à®Ÿà¯à®Ÿà¯à®ªà¯à®ªà®Ÿà¯à®¤à¯à®¤ à®®à¯à®Ÿà®¿à®¨à¯à®¤à®¾à®²à¯, à®à®¤à¯ˆà®¯à¯à®®à¯ à®šà®¾à®¤à®¿à®•à¯à®• à®®à¯à®Ÿà®¿à®¯à¯à®®à¯.",
                    "à®à®©à¯ à®†à®°à®®à¯à®ªà®¿à®¤à¯à®¤à¯€à®°à¯à®•à®³à¯ à®à®©à¯à®±à¯ à®šà®¿à®¨à¯à®¤à®¿à®¯à¯à®™à¯à®•à®³à¯. à®…à®¨à¯à®¤ à®‡à®²à®•à¯à®•à¯ˆ à®‡à®ªà¯à®ªà¯‹à®¤à¯ à®•à¯ˆà®µà®¿à®Ÿà®¾à®¤à¯€à®°à¯à®•à®³à¯.",
                    "à®’à®°à¯ à®šà®¿à®±à®¿à®¯ à®¨à®Ÿà¯ˆà®ªà¯à®ªà®¯à®¿à®±à¯à®šà®¿ à®šà¯†à®²à¯à®²à¯à®™à¯à®•à®³à¯. à®‰à®™à¯à®•à®³à¯ à®šà¯‚à®´à®²à¯ˆ à®®à®¾à®±à¯à®±à¯à®µà®¤à¯ à®†à®šà¯ˆà®¯à®¿à®©à¯ à®šà¯à®´à®±à¯à®šà®¿à®¯à¯ˆ à®‰à®Ÿà¯ˆà®•à¯à®•à¯à®®à¯.",
                    "à®šà®°à¯à®•à¯à®•à®°à¯ˆ à®‡à®²à¯à®²à®¾à®¤ à®ªà®ªà¯à®³à¯ à®•à®®à¯ à®…à®²à¯à®²à®¤à¯ à®†à®°à¯‹à®•à¯à®•à®¿à®¯à®®à®¾à®© à®šà®¿à®±à¯à®±à¯à®£à¯à®Ÿà®¿à®¯à¯ˆ à®®à¯†à®²à¯à®²à¯à®™à¯à®•à®³à¯. à®®à¯†à®²à¯à®²à¯à®®à¯ à®šà¯†à®¯à®²à¯ à®®à®© à®…à®´à¯à®¤à¯à®¤à®¤à¯à®¤à¯ˆà®•à¯ à®•à¯à®±à¯ˆà®•à¯à®•à¯à®®à¯.",
                    "à®‰à®™à¯à®•à®³à¯à®•à¯à®•à¯à®ªà¯ à®ªà®¿à®Ÿà®¿à®¤à¯à®¤ à®ªà®¾à®Ÿà®²à¯ˆà®•à¯ à®•à¯‡à®³à¯à®™à¯à®•à®³à¯. à®‡à®šà¯ˆ à®‰à®™à¯à®•à®³à¯ à®®à®©à®¨à®¿à®²à¯ˆà®¯à¯ˆ à®‰à®Ÿà®©à®Ÿà®¿à®¯à®¾à®• à®‰à®¯à®°à¯à®¤à¯à®¤à®¿, à®†à®šà¯ˆà®•à®³à®¿à®²à®¿à®°à¯à®¨à¯à®¤à¯ à®¤à®¿à®šà¯ˆ à®¤à®¿à®°à¯à®ªà¯à®ªà¯à®®à¯.",
                    "à®†à®¤à®°à®µà®¿à®±à¯à®•à®¾à®• à®’à®°à¯ à®¨à®£à¯à®ªà®°à¯ à®…à®²à¯à®²à®¤à¯ à®•à¯à®Ÿà¯à®®à¯à®ª à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯à®•à¯à®•à¯ à®®à¯†à®šà¯‡à®œà¯ à®…à®²à¯à®²à®¤à¯ à®•à®¾à®²à¯ à®šà¯†à®¯à¯à®¯à¯à®™à¯à®•à®³à¯. à®’à®°à¯ à®šà®¿à®±à®¿à®¯ à®‰à®°à¯ˆà®¯à®¾à®Ÿà®²à¯ à®ªà¯†à®°à®¿à®¯ à®®à®¾à®±à¯à®±à®¤à¯à®¤à¯ˆ à®à®±à¯à®ªà®Ÿà¯à®¤à¯à®¤à¯à®®à¯.",
                    "à®¨à¯€à®™à¯à®•à®³à¯ à®šà¯‡à®®à®¿à®•à¯à®•à¯à®®à¯ à®ªà®£à®¤à¯à®¤à¯ˆ à®¨à¯€à®™à¯à®•à®³à¯‡ à®¨à®¿à®©à¯ˆà®µà¯à®ªà®Ÿà¯à®¤à¯à®¤à®¿à®•à¯ à®•à¯Šà®³à¯à®³à¯à®™à¯à®•à®³à¯. à®…à®¤à¯ˆà®•à¯ à®•à¯Šà®£à¯à®Ÿà¯ à®à®©à¯à®© à®µà®¾à®™à¯à®•à®²à®¾à®®à¯ à®à®©à¯à®±à¯ à®šà®¿à®¨à¯à®¤à®¿à®¯à¯à®™à¯à®•à®³à¯.",
                    "à®‰à®™à¯à®•à®³à¯ à®¤à¯Šà®²à¯ˆà®ªà¯‡à®šà®¿à®¯à®¿à®²à¯ à®’à®°à¯ à®µà®¿à®°à¯ˆà®µà®¾à®© à®µà®¿à®³à¯ˆà®¯à®¾à®Ÿà¯à®Ÿà¯ˆ à®µà®¿à®³à¯ˆà®¯à®¾à®Ÿà¯à®™à¯à®•à®³à¯. à®‰à®™à¯à®•à®³à¯ à®®à®©à®¤à¯ˆ à®ˆà®Ÿà¯à®ªà®Ÿà¯à®¤à¯à®¤à¯à®µà®¤à¯ à®†à®šà¯ˆ à®•à®Ÿà®¨à¯à®¤à¯ à®šà¯†à®²à¯à®² à®‰à®¤à®µà¯à®®à¯."
                ],
                statusPass: "à®µà¯†à®±à¯à®±à®¿",
                statusFail: "à®¤à¯‹à®²à¯à®µà®¿",
                statusPending: "à®¨à®¿à®²à¯à®µà¯ˆà®¯à®¿à®²à¯",
                statusWaiting: "à®•à®¾à®¤à¯à®¤à®¿à®°à¯"
            }
        };

        const quotes = {
            en: [ "Believe you can and you're halfway there.", "It does not matter how slowly you go as long as you do not stop.", "Success is the sum of small efforts, repeated day in and day out." ],
            ta: [ "à®®à¯à®Ÿà®¿à®¯à¯à®®à¯ à®à®©à¯à®±à¯ à®¨à®®à¯à®ªà¯à®™à¯à®•à®³à¯, à®¨à¯€à®™à¯à®•à®³à¯ à®ªà®¾à®¤à®¿ à®¤à¯‚à®°à®®à¯ à®•à®Ÿà®¨à¯à®¤à¯à®µà®¿à®Ÿà¯à®Ÿà¯€à®°à¯à®•à®³à¯.", "à®¨à¯€à®™à¯à®•à®³à¯ à®¨à®¿à®±à¯à®¤à¯à®¤à®¾à®¤ à®µà®°à¯ˆ à®à®µà¯à®µà®³à®µà¯ à®®à¯†à®¤à¯à®µà®¾à®•à®šà¯ à®šà¯†à®©à¯à®±à®¾à®²à¯à®®à¯ à®ªà®°à®µà®¾à®¯à®¿à®²à¯à®²à¯ˆ.", "à®µà¯†à®±à¯à®±à®¿ à®à®©à¯à®ªà®¤à¯ à®¤à®¿à®©à®šà®°à®¿ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®šà¯†à®¯à¯à®¯à®ªà¯à®ªà®Ÿà¯à®®à¯ à®šà®¿à®±à¯ à®®à¯à®¯à®±à¯à®šà®¿à®•à®³à®¿à®©à¯ à®•à¯‚à®Ÿà¯à®Ÿà¯à®¤à¯à®¤à¯Šà®•à¯ˆ." ]
        };

        // --- Core Functions ---
        function init() {
            loadState();
            updateUIForLanguage();
            
            if (state.plan.length > 0) {
                const finalDay = state.plan[state.plan.length -1];
                if(finalDay.target === 0 && finalDay.status === 'Pass'){
                    showScreen('congrats');
                } else {
                    showScreen('main');
                    render();
                    checkDailyStatus();
                }
            } else {
                showScreen('setup');
            }
            setupEventListeners();
        }

        function setupEventListeners() {
            languageSwitcher.addEventListener('click', toggleLanguage);
            setupForm.addEventListener('submit', startJourney);
            smokedButton.addEventListener('click', handleSmokedClick);
            urgeButton.addEventListener('click', showUrgeModal);
        }
        
        function toggleLanguage() {
            state.language = state.language === 'en' ? 'ta' : 'en';
            saveState();
            updateUIForLanguage();
            if (state.plan.length > 0) {
                render(); 
            }
        }
        
        function updateUIForLanguage() {
            languageSwitcher.textContent = state.language === 'en' ? 'à®¤à®®à®¿à®´à¯' : 'English';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[state.language][key]) {
                    el.textContent = translations[state.language][key];
                }
            });
            runningMessageEl.textContent = translations[state.language].runningMessage;
        }

        function startJourney(e) {
            e.preventDefault();
            const count = parseInt(initialCigarettesInput.value);
            if (count > 0) {
                state.initialCount = count;
                state.startDate = getTodayDateString();
                state.lastCheckedDate = getYesterdayDateString(); 
                generatePlan();
                saveState();
                showScreen('main');
                render();
            }
        }

        function generatePlan() {
            state.plan = [];
            let currentDate = new Date();
            let weekCounter = 0;
            
            while(true) {
                const weekNumber = Math.floor(weekCounter / 7);
                const dailyTarget = Math.max(0, state.initialCount - 1 - weekNumber);
                
                state.plan.push({
                    date: toISODateString(currentDate),
                    target: dailyTarget,
                    smoked: 0,
                    status: 'Pending'
                });

                if (dailyTarget === 0) break;

                currentDate.setDate(currentDate.getDate() + 1);
                weekCounter++;
            }
        }

        function handleSmokedClick() {
            const todayEntry = getTodayEntry();
            if (todayEntry && todayEntry.smoked < todayEntry.target) {
                todayEntry.smoked += 1;
                if (todayEntry.smoked >= todayEntry.target) {
                    todayEntry.status = 'Waiting';
                }
                saveState();
                render();
            }
        }

        function render() {
            renderDashboard();
            renderTable();
        }

        function renderDashboard() {
            const todayEntry = getTodayEntry();
            if (todayEntry) {
                targetCountEl.textContent = todayEntry.target;
                smokedCountEl.textContent = todayEntry.smoked;

                const { smoked, target } = todayEntry;
                smokedCountEl.classList.remove('text-green-400', 'text-amber-400', 'text-red-400');
                if (target > 0) {
                    if (smoked <= target / 3) {
                        smokedCountEl.classList.add('text-green-400');
                    } else if (smoked <= (target * 2) / 3) {
                        smokedCountEl.classList.add('text-amber-400');
                    } else {
                        smokedCountEl.classList.add('text-red-400');
                    }
                } else {
                     smokedCountEl.classList.add('text-green-400');
                }
                
                if (smoked >= target) {
                    smokedButton.classList.add('hidden');
                    limitReachedControls.classList.remove('hidden');
                    limitReachedButton.innerHTML = translations[state.language].limitReachedText;
                    startCountdown();
                } else {
                    smokedButton.classList.remove('hidden');
                    limitReachedControls.classList.add('hidden');
                    stopCountdown();
                }
            } else {
                targetCountEl.textContent = '0';
                smokedCountEl.textContent = '0';
                smokedButton.classList.add('hidden');
            }
        }
        
        function renderTable() {
            progressTableBody.innerHTML = '';
            const todayStr = getTodayDateString();
            state.plan.forEach(day => {
                const isToday = day.date === todayStr;
                const rowClass = isToday ? 'bg-slate-700/50 font-semibold' : '';
                
                let statusClass = '';
                let statusText = translations[state.language].statusPending;
                
                if (day.status === 'Pass') {
                    statusClass = 'text-green-400';
                    statusText = translations[state.language].statusPass;
                } else if (day.status === 'Fail') {
                    statusClass = 'text-red-400';
                    statusText = translations[state.language].statusFail;
                } else if (day.status === 'Waiting') {
                    statusClass = 'text-amber-400';
                    statusText = translations[state.language].statusWaiting;
                }

                const row = `
                    <tr class="${rowClass}">
                        <td class="py-3 px-2">${formatDate(day.date)}</td>
                        <td class="py-3 px-2 text-center">${day.target}</td>
                        <td class="py-3 px-2 text-center">${day.smoked}</td>
                        <td class="py-3 px-2 text-center font-semibold ${statusClass}">${statusText}</td>
                    </tr>
                `;
                progressTableBody.insertAdjacentHTML('beforeend', row);
            });
        }
        
        function checkDailyStatus() {
            const todayStr = getTodayDateString();
            if(state.lastCheckedDate === todayStr) return;
            
            let showMotivation = false;
            
            state.plan.forEach(day => {
                if (day.date < todayStr && (day.status === 'Pending' || day.status === 'Waiting')) {
                    day.status = day.smoked <= day.target ? 'Pass' : 'Fail';
                    if (day.date === getYesterdayDateString() && day.status === 'Pass') {
                        showMotivation = true;
                    }
                }
            });

            if (showMotivation) {
                showMotivationModal();
            }

            state.lastCheckedDate = todayStr;
            saveState();
            renderTable();
        }

        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);

            countdownInterval = setInterval(() => {
                const now = new Date();
                const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0);
                const diff = midnight - now;

                if (diff <= 0) {
                    stopCountdown();
                    location.reload();
                    return;
                }

                const hours = String(Math.floor((diff / (1000 * 60 * 60)) % 24)).padStart(2, '0');
                const minutes = String(Math.floor((diff / 1000 / 60) % 60)).padStart(2, '0');
                const seconds = String(Math.floor((diff / 1000) % 60)).padStart(2, '0');
                
                const countdownSpan = document.getElementById('countdown-timer');
                if (countdownSpan) {
                    countdownSpan.textContent = `${hours}:${minutes}:${seconds}`;
                }
            }, 1000);
        }
        
        function stopCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }

        // --- View & Modal Controls ---
        function showScreen(screenName) {
            setupScreen.classList.add('hidden');
            mainScreen.classList.add('hidden');
            congratsScreen.classList.add('hidden');

            if(screenName === 'setup') setupScreen.classList.remove('hidden');
            if(screenName === 'main') mainScreen.classList.remove('hidden');
            if(screenName === 'congrats') congratsScreen.classList.remove('hidden');
        }
        
        function showMotivationModal() {
            const langQuotes = quotes[state.language];
            const randomQuote = langQuotes[Math.floor(Math.random() * langQuotes.length)];
            motivationQuoteEl.textContent = `"${randomQuote}"`;
            motivationModal.classList.remove('hidden');
            motivationModal.querySelector('.modal-content').classList.add('scale-100');
        }

        function showUrgeModal() {
            const urgeTips = translations[state.language].urgeTips;
            let randomIndex;
            
            do {
                randomIndex = Math.floor(Math.random() * urgeTips.length);
            } while (urgeTips.length > 1 && randomIndex === lastUrgeTipIndex);

            lastUrgeTipIndex = randomIndex;
            const randomTip = urgeTips[randomIndex];

            urgeQuoteEl.textContent = randomTip;
            urgeModal.classList.remove('hidden');
            urgeModal.querySelector('.modal-content').classList.add('scale-100');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('.modal-content').classList.remove('scale-100');
            modal.classList.add('hidden');
        }

        // --- Local Storage ---
        function saveState() {
            localStorage.setItem('smokeFreeState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('smokeFreeState');
            if (savedState) {
                state = JSON.parse(savedState);
            }
        }

        // --- Date Helpers ---
        function getTodayEntry() {
            return state.plan.find(day => day.date === getTodayDateString());
        }
        
        function getTodayDateString() {
            return toISODateString(new Date());
        }
        
        function getYesterdayDateString() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            return toISODateString(yesterday);
        }

        function toISODateString(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { month: 'short', day: 'numeric' };
            return date.toLocaleDateString(state.language === 'ta' ? 'ta-IN' : 'en-US', options);
        }
        
        // --- Start the App ---
        init();
    </script>
</body>
</html>


