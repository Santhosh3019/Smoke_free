<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoke-Free Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
        .marquee-container { overflow: hidden; white-space: nowrap; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 25s linear infinite; }
        @keyframes marquee {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4A5568; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }
        .form-input.invalid {
            border-color: #F87171; /* red-400 */
        }
        .form-input:focus {
             outline: none;
             box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.5); /* Equivalent to ring-2 ring-cyan-500/50 */
             border-color: #22D3EE; /* cyan-400 */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-gray-900 text-slate-200 antialiased">

    <!-- Main Container -->
    <div id="app-container" class="min-h-screen max-w-lg mx-auto p-4 flex flex-col fade-in">
        
        <!-- Header -->
        <header id="app-header" class="flex justify-between items-center mb-6 pb-4 border-b border-slate-700/50">
            <h1 class="text-2xl font-bold text-cyan-400 tracking-wide" data-translate="appTitle">Smoke-Free Journey</h1>
            <button id="language-switcher" class="px-3 py-1 text-sm font-semibold bg-slate-800 rounded-full hover:bg-slate-700 transition-colors shadow-md">родрооро┐ро┤рпН</button>
        </header>

        <!-- Initial Setup Screen -->
        <div id="setup-screen" class="hidden flex-grow flex flex-col justify-center items-center text-center p-4">
             <div class="w-full bg-slate-800/50 p-8 rounded-2xl shadow-2xl">
                 <h2 class="text-3xl font-bold mb-2" data-translate="welcomeTitle">Welcome!</h2>
                 <p class="text-slate-400 mb-8" data-translate="welcomeSubtitle">Let's start your journey to a smoke-free life.</p>
                 <form id="setup-form" class="space-y-6">
                     <label for="initial-cigarettes" class="block text-lg font-medium mb-2" data-translate="initialCigarettesLabel">How many cigarettes do you smoke per day?</label>
                     <input type="number" id="initial-cigarettes" class="w-full bg-slate-900 border-2 border-slate-700 text-white text-center text-3xl rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition" placeholder="e.g., 15" required min="1">
                     <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 shadow-lg shadow-cyan-500/20" data-translate="startButton">Start Journey</button>
                 </form>
             </div>
        </div>

        <!-- Main App Screen -->
        <div id="main-screen" class="hidden flex-grow flex flex-col">
            <!-- Dashboard, Action Buttons, Running Message, Progress Log... -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-center">
                 <div class="bg-slate-800/70 p-4 rounded-xl shadow-lg flex items-center justify-center space-x-4">
                     <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                     <div>
                         <p class="text-sm text-slate-400" data-translate="todaysTarget">Today's Target</p>
                         <p id="target-count" class="text-4xl font-bold text-green-400">14</p>
                     </div>
                 </div>
                 <div class="bg-slate-800/70 p-4 rounded-xl shadow-lg flex items-center justify-center space-x-4">
                      <svg class="w-8 h-8 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.657 7.343A8 8 0 0117.657 18.657z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.343 17.657a8 8 0 0110.607-10.607L15 12l-4.657 5.657z"></path></svg>
                     <div>
                         <p class="text-sm text-slate-400" data-translate="smokedToday">Smoked Today</p>
                         <p id="smoked-count" class="text-4xl font-bold">0</p>
                     </div>
                 </div>
            </div>
            <div class="mb-6 space-y-3">
                 <button id="smoked-button" class="w-full bg-gradient-to-r from-rose-600 to-red-600 hover:from-rose-700 hover:to-red-700 text-white font-bold py-4 px-4 rounded-lg text-lg transition-transform transform hover:scale-105 shadow-lg shadow-red-500/20" data-translate="smokedButton">I Smoked a Cigarette</button>
                 <div id="limit-reached-controls" class="hidden grid grid-cols-2 gap-3">
                     <button id="limit-reached-button" class="w-full bg-slate-800 text-amber-400 font-bold py-3 px-4 rounded-lg text-sm text-center shadow-md"></button>
                     <button id="urge-button" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg text-sm text-center shadow-lg shadow-cyan-500/20" data-translate="urgeButton">Had an Urge?</button>
                 </div>
            </div>
            <div class="bg-slate-800/50 rounded-lg p-2 mb-6 marquee-container shadow-md">
                  <p id="running-message" class="text-cyan-300 text-sm marquee-text"></p>
            </div>
            <div class="flex-grow bg-slate-800/50 rounded-xl p-4 overflow-y-auto shadow-inner">
                 <h3 class="text-lg font-bold mb-4 text-slate-300" data-translate="progressLogTitle">Progress Log</h3>
                 <div class="overflow-x-auto">
                     <table class="w-full text-sm text-left">
                         <thead class="text-xs text-slate-400 uppercase">
                             <tr>
                                 <th scope="col" class="py-3 px-2" data-translate="dateHeader">Date</th>
                                 <th scope="col" class="py-3 px-2 text-center" data-translate="targetHeader">Target</th>
                                 <th scope="col" class="py-3 px-2 text-center" data-translate="smokedHeader">Smoked</th>
                                 <th scope="col" class="py-3 px-2 text-center" data-translate="statusHeader">Status</th>
                             </tr>
                         </thead>
                         <tbody id="progress-table-body" class="divide-y divide-slate-700/50"></tbody>
                     </table>
                 </div>
            </div>
        </div>
        
        <!-- Congratulations Screen -->
        <div id="congrats-screen" class="hidden flex-grow flex flex-col justify-center items-center text-center p-4">
             <div class="text-7xl mb-4">ЁЯОЙ</div>
             <h2 class="text-4xl font-bold text-green-400 mb-2" data-translate="congratsTitle">Congratulations!</h2>
             <p class="text-slate-300 mb-8 max-w-md" data-translate="congratsSubtitle">You have completed your journey and are now smoke-free! We are proud of you.</p>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="generic-modal" class="fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto text-center modal-content transform scale-95 shadow-2xl border border-slate-700">
            <h3 id="generic-modal-title" class="text-xl font-bold mb-4 text-cyan-400">Notice</h3>
            <p id="generic-modal-text" class="text-slate-300 mb-6">Message goes here.</p>
            <button onclick="closeModal('generic-modal')" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>
    <div id="urge-modal" class="fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto text-center modal-content transform scale-95 shadow-2xl border border-slate-700">
             <div class="text-5xl mb-4">ЁЯТк</div>
            <h3 class="text-xl font-bold mb-4 text-cyan-400" data-translate="urgeTitle">Stay Strong!</h3>
            <p id="urge-quote" class="text-slate-300 mb-6">A craving is just a thought. You are in control, not the thought.</p>
            <button onclick="closeModal('urge-modal')" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="urgeCloseButton">I Can Do This!</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const setupScreen = document.getElementById('setup-screen');
        const mainScreen = document.getElementById('main-screen');
        const congratsScreen = document.getElementById('congrats-screen');
        const setupForm = document.getElementById('setup-form');
        const initialCigarettesInput = document.getElementById('initial-cigarettes');
        const languageSwitcher = document.getElementById('language-switcher');
        const targetCountEl = document.getElementById('target-count');
        const smokedCountEl = document.getElementById('smoked-count');
        const smokedButton = document.getElementById('smoked-button');
        const limitReachedControls = document.getElementById('limit-reached-controls');
        const limitReachedButton = document.getElementById('limit-reached-button');
        const urgeButton = document.getElementById('urge-button');
        const runningMessageEl = document.getElementById('running-message');
        const progressTableBody = document.getElementById('progress-table-body');
        const genericModal = document.getElementById('generic-modal');
        const genericModalTitle = document.getElementById('generic-modal-title');
        const genericModalText = document.getElementById('generic-modal-text');
        const urgeModal = document.getElementById('urge-modal');
        const urgeQuoteEl = document.getElementById('urge-quote');

        // --- App State ---
        let state = {}; 
        let countdownInterval = null;
        let lastUrgeTipIndex = -1;

        // --- Translations ---
        const translations = {
             en: {
                appTitle: "Smoke-Free Journey",
                welcomeTitle: "Welcome!",
                welcomeSubtitle: "Let's start your journey to a smoke-free life.",
                initialCigarettesLabel: "How many cigarettes do you smoke per day?",
                startButton: "Start Journey",
                todaysTarget: "Today's Target",
                smokedToday: "Smoked Today",
                smokedButton: "I Smoked a Cigarette",
                progressLogTitle: "Progress Log",
                dateHeader: "Date",
                targetHeader: "Target",
                smokedHeader: "Smoked",
                statusHeader: "Status",
                congratsTitle: "Congratulations!",
                congratsSubtitle: "You have completed your journey and are now smoke-free! We are proud of you.",
                runningMessage: "Don't be a slave to a stick of paper and leaves. Break the chains with every craving you conquer.",
                urgeButton: "Had an Urge?",
                urgeTitle: "Stay Strong!",
                urgeCloseButton: "I Can Do This!",
                 urgeTips: [
                    "Take a deep breath and a sip of cold water. Wait 5 minutes, the feeling will pass.",
                    "Eat something you like! A healthy snack can distract you and satisfy cravings.",
                    "Successful people are self-controlled. If you can control this, you can achieve anything.",
                    "Think about why you started. Don't give up on that goal now.",
                    "Go for a short walk. Changing your environment can break the craving cycle.",
                    "Chew on some sugar-free gum or a healthy snack. The act of chewing can relieve stress.",
                    "Listen to your favorite song. Music can instantly lift your mood and distract you from cravings.",
                    "Text or call a friend or family member for support. A quick chat can make a big difference.",
                    "Remind yourself of the money you're saving. Think about what you can buy with it.",
                    "Play a quick game on your phone. Engaging your mind can help the craving pass."
                ],
                limitReachedText: "Next in <span id='countdown-timer' class='text-white'>--:--:--</span>",
                statusPass: "Pass", statusFail: "Fail", statusPending: "Pending", statusWaiting: "Wait"
            },
            ta: {
                appTitle: "рокрпБроХрпИрокрпНрокро┐роЯро┐роХрпНроХро╛род рокропрогроорпН",
                welcomeTitle: "ро╡ро╛ро░рпБроЩрпНроХро│рпН!", 
                welcomeSubtitle: "рокрпБроХрпИропро▒рпНро▒ ро╡ро╛ро┤рпНроХрпНроХрпИропрпИ роирпЛроХрпНроХро┐роп роЙроЩрпНроХро│рпН рокропрогродрпНродрпИродрпН родрпКроЯроЩрпНроХрпБро╡рпЛроорпН.",
                initialCigarettesLabel: "роТро░рпБ роиро╛ро│рпИроХрпНроХрпБ роОродрпНродройрпИ роЪро┐роХро░рпЖроЯрпН рокрпБроХрпИроХрпНроХро┐ро▒рпАро░рпНроХро│рпН?",
                startButton: "рокропрогродрпНродрпИродрпН родрпКроЯроЩрпНроХрпБ", 
                todaysTarget: "роЗройрпНро▒рпИроп роЗро▓роХрпНроХрпБ", 
                smokedToday: "роЗройрпНро▒рпБ рокрпБроХрпИродрпНродродрпБ",
                smokedButton: "роиро╛ройрпН роТро░рпБ роЪро┐роХро░рпЖроЯрпН рокро┐роЯро┐родрпНродрпЗройрпН", 
                progressLogTitle: "роорпБройрпНройрпЗро▒рпНро▒рокрпН рокродро┐ро╡рпБ",
                dateHeader: "родрпЗродро┐", 
                targetHeader: "роЗро▓роХрпНроХрпБ", 
                smokedHeader: "рокрпБроХрпИродрпНродродрпБ", 
                statusHeader: "роиро┐ро▓рпИ",
                congratsTitle: "ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН!", 
                congratsSubtitle: "роЙроЩрпНроХро│рпН рокропрогродрпНродрпИ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роорпБроЯро┐родрпНродрпБро╡ро┐роЯрпНроЯрпАро░рпНроХро│рпН, роЗрокрпНрокрпЛродрпБ роирпАроЩрпНроХро│рпН рокрпБроХрпИрокрпНрокро┐роЯро┐роХрпНроХро╛родро╡ро░рпН! роЙроЩрпНроХро│рпИ роиро┐ройрпИродрпНродрпБ роиро╛роЩрпНроХро│рпН рокрпЖро░рпБроорпИрокрпНрокроЯрпБроХро┐ро▒рпЛроорпН.",
                runningMessage: "роТро░рпБ роХро╛роХро┐родродрпНродро┐ро▒рпНроХрпБроорпН роЗро▓рпИроХро│рпБроХрпНроХрпБроорпН роЕроЯро┐роорпИропро╛роХ роЗро░рпБроХрпНроХро╛родрпАро░рпНроХро│рпН. роирпАроЩрпНроХро│рпН ро╡рпЖро▓рпНро▓рпБроорпН роТро╡рпНро╡рпКро░рпБ роПроХрпНроХродрпНродрпБроЯройрпБроорпН роЪроЩрпНроХро┐ро▓ро┐роХро│рпИ роЙроЯрпИроХрпНроХро╡рпБроорпН.",
                urgeButton: "роТро░рпБ роЖроЪрпИропро╛?", 
                urgeTitle: "родро┐роЯрооро╛роХ роЗро░рпБроЩрпНроХро│рпН!", 
                urgeCloseButton: "роОройрпНройро╛ро▓рпН роорпБроЯро┐ропрпБроорпН!",
                 urgeTips: [
                    "роЖро┤рпНроирпНрод роорпВроЪрпНроЪрпБ ро╡ро┐роЯрпБроЩрпНроХро│рпН, роХрпБро│ро┐ро░рпН роирпАро░рпН роХрпБроЯро┐ропрпБроЩрпНроХро│рпН. 5 роиро┐рооро┐роЯроЩрпНроХро│рпН роХро╛родрпНродро┐ро░рпБроЩрпНроХро│рпН, роЕроирпНрод роЙрогро░рпНро╡рпБ роХроЯроирпНродрпБ рокрпЛроХрпБроорпН.",
                    "роЙроЩрпНроХро│рпБроХрпНроХрпБрокрпН рокро┐роЯро┐родрпНрод роТройрпНро▒рпИроЪрпН роЪро╛рокрпНрокро┐роЯрпБроЩрпНроХро│рпН! роТро░рпБ роЪро┐ро▒рпНро▒рпБрогрпНроЯро┐ роЙроЩрпНроХро│рпН роХро╡ройродрпНродрпИ родро┐роЪрпИ родро┐ро░рпБрокрпНрокрпБроорпН.",
                    "ро╡рпЖро▒рпНро▒ро┐ропро╛ро│ро░рпНроХро│рпН родройрпНройроЯроХрпНроХроорпН роХрпКрогрпНроЯро╡ро░рпНроХро│рпН. роЗродрпИ роЙроЩрпНроХро│ро╛ро▓рпН роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНрод роорпБроЯро┐роирпНродро╛ро▓рпН, роОродрпИропрпБроорпН роЪро╛родро┐роХрпНроХ роорпБроЯро┐ропрпБроорпН.",
                    "роПройрпН роЖро░роорпНрокро┐родрпНродрпАро░рпНроХро│рпН роОройрпНро▒рпБ роЪро┐роирпНродро┐ропрпБроЩрпНроХро│рпН. роЕроирпНрод роЗро▓роХрпНроХрпИ роЗрокрпНрокрпЛродрпБ роХрпИро╡ро┐роЯро╛родрпАро░рпНроХро│рпН.",
                    "роТро░рпБ роЪро┐ро▒ро┐роп роироЯрпИрокрпНрокропро┐ро▒рпНроЪро┐ роЪрпЖро▓рпНро▓рпБроЩрпНроХро│рпН. роЙроЩрпНроХро│рпН роЪрпВро┤ро▓рпИ рооро╛ро▒рпНро▒рпБро╡родрпБ роЖроЪрпИропро┐ройрпН роЪрпБро┤ро▒рпНроЪро┐ропрпИ роЙроЯрпИроХрпНроХрпБроорпН.",
                    "роЪро░рпНроХрпНроХро░рпИ роЗро▓рпНро▓ро╛род рокрокрпБро│рпН роХроорпН роЕро▓рпНро▓родрпБ роЖро░рпЛроХрпНроХро┐ропрооро╛рой роЪро┐ро▒рпНро▒рпБрогрпНроЯро┐ропрпИ роорпЖро▓рпНро▓рпБроЩрпНроХро│рпН. роорпЖро▓рпНро▓рпБроорпН роЪрпЖропро▓рпН роорой роЕро┤рпБродрпНродродрпНродрпИроХрпН роХрпБро▒рпИроХрпНроХрпБроорпН.",
                    "роЙроЩрпНроХро│рпБроХрпНроХрпБрокрпН рокро┐роЯро┐родрпНрод рокро╛роЯро▓рпИроХрпН роХрпЗро│рпБроЩрпНроХро│рпН. роЗроЪрпИ роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИ роЙроЯройроЯро┐ропро╛роХ роЙропро░рпНродрпНродро┐, роЖроЪрпИроХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ родро┐роЪрпИ родро┐ро░рпБрокрпНрокрпБроорпН.",
                    "роЖродро░ро╡ро┐ро▒рпНроХро╛роХ роТро░рпБ роирогрпНрокро░рпН роЕро▓рпНро▓родрпБ роХрпБроЯрпБроорпНрок роЙро▒рпБрокрпНрокро┐ройро░рпБроХрпНроХрпБ роорпЖроЪрпЗроЬрпН роЕро▓рпНро▓родрпБ роХро╛ро▓рпН роЪрпЖропрпНропрпБроЩрпНроХро│рпН. роТро░рпБ роЪро┐ро▒ро┐роп роЙро░рпИропро╛роЯро▓рпН рокрпЖро░ро┐роп рооро╛ро▒рпНро▒родрпНродрпИ роПро▒рпНрокроЯрпБродрпНродрпБроорпН.",
                    "роирпАроЩрпНроХро│рпН роЪрпЗрооро┐роХрпНроХрпБроорпН рокрогродрпНродрпИ роирпАроЩрпНроХро│рпЗ роиро┐ройрпИро╡рпБрокроЯрпБродрпНродро┐роХрпН роХрпКро│рпНро│рпБроЩрпНроХро│рпН. роЕродрпИроХрпН роХрпКрогрпНроЯрпБ роОройрпНрой ро╡ро╛роЩрпНроХро▓ро╛роорпН роОройрпНро▒рпБ роЪро┐роирпНродро┐ропрпБроЩрпНроХро│рпН.",
                    "роЙроЩрпНроХро│рпН родрпКро▓рпИрокрпЗроЪро┐ропро┐ро▓рпН роТро░рпБ ро╡ро┐ро░рпИро╡ро╛рой ро╡ро┐ро│рпИропро╛роЯрпНроЯрпИ ро╡ро┐ро│рпИропро╛роЯрпБроЩрпНроХро│рпН. роЙроЩрпНроХро│рпН рооройродрпИ роИроЯрпБрокроЯрпБродрпНродрпБро╡родрпБ роЖроЪрпИ роХроЯроирпНродрпБ роЪрпЖро▓рпНро▓ роЙродро╡рпБроорпН."
                ],
                limitReachedText: "роЕроЯрпБродрпНродрпБ <span id='countdown-timer' class='text-white'>--:--:--</span>",
                statusPass: "ро╡рпЖро▒рпНро▒ро┐", 
                statusFail: "родрпЛро▓рпНро╡ро┐", 
                statusPending: "роиро┐ро▓рпБро╡рпИропро┐ро▓рпН", 
                statusWaiting: "роХро╛родрпНродро┐ро░рпБ"
            }
        };

        // --- Core App Functions ---
        function init() {
            loadState();
            updateUIForLanguage();
            if (state.plan && state.plan.length > 0) {
                 const finalDay = state.plan[state.plan.length -1];
                 if(finalDay.target === 0 && finalDay.status === 'Pass'){
                     showScreen('congrats');
                 } else {
                     showScreen('main');
                     render();
                     checkDailyStatus();
                 }
            } else {
                showScreen('setup');
            }
            setupEventListeners();
        }

        function setupEventListeners() {
            setupForm.addEventListener('submit', startJourney);
            languageSwitcher.addEventListener('click', toggleLanguage);
            smokedButton.addEventListener('click', handleSmokedClick);
            urgeButton.addEventListener('click', showUrgeModal);
        }

        function startJourney(e) {
            e.preventDefault();
            const count = parseInt(initialCigarettesInput.value);
            if (count > 0) {
                state.initialCount = count;
                state.startDate = getTodayDateString();
                state.lastCheckedDate = getYesterdayDateString();
                generatePlan();
                saveState();
                showScreen('main');
                render();
            }
        }

        function showScreen(screenName) {
            setupScreen.classList.add('hidden');
            mainScreen.classList.add('hidden');
            congratsScreen.classList.add('hidden');

            if(screenName === 'setup') setupScreen.classList.remove('hidden');
            if(screenName === 'main') mainScreen.classList.remove('hidden');
            if(screenName === 'congrats') congratsScreen.classList.remove('hidden');
        }

        function toggleLanguage() {
            state.language = state.language === 'en' ? 'ta' : 'en';
            saveState();
            updateUIForLanguage();
            if (state.plan && state.plan.length > 0) {
                render(); 
            }
        }

        function handleSmokedClick() {
            const todayEntry = getTodayEntry();
            if (todayEntry && todayEntry.smoked < todayEntry.target) {
                todayEntry.smoked += 1;
                if (todayEntry.smoked >= todayEntry.target) {
                    todayEntry.status = 'Waiting';
                }
                saveState();
                render();
            }
        }

        function checkDailyStatus() {
            const todayStr = getTodayDateString();
            if(!state.plan || state.lastCheckedDate === todayStr) return;
            
            let showMotivation = false;
            
            state.plan.forEach(day => {
                if (day.date < todayStr && (day.status === 'Pending' || day.status === 'Waiting')) {
                    day.status = day.smoked <= day.target ? 'Pass' : 'Fail';
                    if (day.date === getYesterdayDateString() && day.status === 'Pass') {
                        showMotivation = true;
                    }
                }
            });

            if (showMotivation) { showModal("Great Job Yesterday!", "Keep up the great work!"); }

            state.lastCheckedDate = todayStr;
            saveState();
            renderTable();
        }

        function generatePlan() { 
            state.plan = []; 
            let currentDate = new Date(); 
            let weekCounter = 0; 
            while(true) { 
                const weekNumber = Math.floor(weekCounter / 7); 
                const dailyTarget = Math.max(0, state.initialCount - 1 - weekNumber); 
                state.plan.push({ date: toISODateString(currentDate), target: dailyTarget, smoked: 0, status: 'Pending' }); 
                if (dailyTarget === 0) break; 
                currentDate.setDate(currentDate.getDate() + 1); 
                weekCounter++; 
            } 
        }

        function renderDashboard() { 
            const todayEntry = getTodayEntry(); 
            if (todayEntry) { 
                targetCountEl.textContent = todayEntry.target; 
                smokedCountEl.textContent = todayEntry.smoked; 
                const { smoked, target } = todayEntry; 
                smokedCountEl.classList.remove('text-green-400', 'text-amber-400', 'text-red-400'); 
                if (target > 0) { 
                    if (smoked <= target / 3) { 
                        smokedCountEl.classList.add('text-green-400'); 
                    } else if (smoked <= (target * 2) / 3) { 
                        smokedCountEl.classList.add('text-amber-400'); 
                    } else { 
                        smokedCountEl.classList.add('text-red-400'); 
                    } 
                } else { 
                    smokedCountEl.classList.add('text-green-400'); 
                } 
                if (smoked >= target) { 
                    smokedButton.classList.add('hidden'); 
                    limitReachedControls.classList.remove('hidden'); 
                    limitReachedButton.innerHTML = translations[state.language].limitReachedText; 
                    startCountdown(); 
                } else { 
                    smokedButton.classList.remove('hidden'); 
                    limitReachedControls.classList.add('hidden'); 
                    stopCountdown(); 
                } 
            } else { 
                targetCountEl.textContent = '0'; 
                smokedCountEl.textContent = '0'; 
                smokedButton.classList.add('hidden'); 
            } 
        }

        function renderTable() { 
            progressTableBody.innerHTML = ''; 
            const todayStr = getTodayDateString(); 
            if (!state.plan) return; 
            state.plan.forEach(day => { 
                const isToday = day.date === todayStr; 
                const rowClass = isToday ? 'bg-slate-700/50 font-semibold' : ''; 
                let statusClass = ''; 
                let statusText = translations[state.language].statusPending; 
                if (day.status === 'Pass') { 
                    statusClass = 'text-green-400'; 
                    statusText = translations[state.language].statusPass; 
                } else if (day.status === 'Fail') { 
                    statusClass = 'text-red-400'; 
                    statusText = translations[state.language].statusFail; 
                } else if (day.status === 'Waiting') { 
                    statusClass = 'text-amber-400'; 
                    statusText = translations[state.language].statusWaiting; 
                } 
                const row = `<tr class="${rowClass}"><td class="py-3 px-2">${formatDate(day.date)}</td><td class="py-3 px-2 text-center">${day.target}</td><td class="py-3 px-2 text-center">${day.smoked}</td><td class="py-3 px-2 text-center font-semibold ${statusClass}">${statusText}</td></tr>`; 
                progressTableBody.insertAdjacentHTML('beforeend', row); 
            }); 
        }

        function render() { 
            renderDashboard(); 
            renderTable(); 
        }

        function startCountdown() { 
            if (countdownInterval) clearInterval(countdownInterval); 
            countdownInterval = setInterval(() => { 
                const now = new Date(); 
                const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0); 
                const diff = midnight - now; 
                if (diff <= 0) { 
                    stopCountdown(); 
                    location.reload(); 
                    return; 
                } 
                const hours = String(Math.floor((diff / (1000 * 60 * 60)) % 24)).padStart(2, '0'); 
                const minutes = String(Math.floor((diff / 1000 / 60) % 60)).padStart(2, '0'); 
                const seconds = String(Math.floor((diff / 1000) % 60)).padStart(2, '0'); 
                const countdownSpan = document.getElementById('countdown-timer'); 
                if (countdownSpan) { 
                    countdownSpan.textContent = `${hours}:${minutes}:${seconds}`; 
                } 
            }, 1000); 
        }

        function stopCountdown() { 
            if (countdownInterval) { 
                clearInterval(countdownInterval); 
                countdownInterval = null; 
            } 
        }

        function showModal(title, text) {
            genericModalTitle.textContent = title;
            genericModalText.textContent = text;
            genericModal.classList.remove('hidden');
            genericModal.querySelector('.modal-content').classList.add('scale-100');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('.modal-content').classList.remove('scale-100');
            modal.classList.add('hidden');
        }

        function showUrgeModal() {
            const urgeTips = translations[state.language]?.urgeTips;
            if (!urgeTips || urgeTips.length === 0) return;

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * urgeTips.length);
            } while (urgeTips.length > 1 && randomIndex === lastUrgeTipIndex);

            lastUrgeTipIndex = randomIndex;
            const randomTip = urgeTips[randomIndex];
            
            if (urgeQuoteEl && urgeModal) {
                urgeQuoteEl.textContent = randomTip;
                urgeModal.classList.remove('hidden');
                urgeModal.querySelector('.modal-content').classList.add('scale-100');
            }
        }

        function saveState() {
            localStorage.setItem('smokeFreeJourneyState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('smokeFreeJourneyState');
            if (savedState) {
                state = JSON.parse(savedState);
            } else {
                state = { language: 'en', plan: [], startDate: null, initialCount: 0, lastCheckedDate: null };
            }
        }
        
        function getTodayEntry() { if (!state.plan) return null; return state.plan.find(day => day.date === getTodayDateString()); }
        function getTodayDateString() { return toISODateString(new Date()); }
        function getYesterdayDateString() { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); return toISODateString(yesterday); }
        function toISODateString(date) { return date.toISOString().split('T')[0]; }
        function formatDate(dateString) { const date = new Date(dateString); const options = { month: 'short', day: 'numeric' }; return date.toLocaleDateString(state.language === 'ta' ? 'ta-IN' : 'en-US', options); }
        function updateUIForLanguage() { 
            languageSwitcher.textContent = state.language === 'en' ? 'родрооро┐ро┤рпН' : 'English'; 
            document.querySelectorAll('[data-translate]').forEach(el => { 
                const key = el.getAttribute('data-translate'); 
                if (translations[state.language] && translations[state.language][key]) { 
                    el.textContent = translations[state.language][key]; 
                } 
            }); 
            if (translations[state.language]) {
                runningMessageEl.textContent = translations[state.language].runningMessage;
            }
        }
        
        init();
    </script>
</body>
</html>

