<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoke-Free Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }
        /* Custom styles for smooth transitions and better UX */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-900 text-white antialiased">

    <!-- Main Container -->
    <div id="app-container" class="min-h-screen max-w-lg mx-auto p-4 flex flex-col fade-in">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-cyan-400" data-translate="appTitle">Smoke-Free Journey</h1>
            <div class="flex items-center space-x-4">
                <button id="header-reset-button" class="text-xs text-slate-400 hover:text-white transition-colors" data-translate="resetButton">Start Over</button>
                <button id="language-switcher" class="px-3 py-1 text-sm font-semibold bg-slate-700 rounded-full hover:bg-slate-600 transition-colors">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
            </div>
        </header>

        <!-- Initial Setup Screen -->
        <div id="setup-screen" class="flex-grow flex flex-col justify-center items-center text-center p-4">
            <div class="w-full">
                <h2 class="text-3xl font-bold mb-2" data-translate="welcomeTitle">Welcome!</h2>
                <p class="text-slate-400 mb-8" data-translate="welcomeSubtitle">Let's start your journey to a smoke-free life.</p>
                <form id="setup-form" class="space-y-4">
                    <label for="initial-cigarettes" class="block text-lg font-medium mb-2" data-translate="initialCigarettesLabel">How many cigarettes do you smoke per day?</label>
                    <input type="number" id="initial-cigarettes" class="w-full bg-slate-800 border-2 border-slate-600 text-white text-center text-2xl rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500" placeholder="e.g., 15" required min="1">
                    <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105" data-translate="startButton">Start Journey</button>
                </form>
            </div>
        </div>

        <!-- Main App Screen (hidden by default) -->
        <div id="main-screen" class="hidden flex-grow flex flex-col">
            <!-- Dashboard -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-center">
                <div class="bg-slate-800 p-4 rounded-xl">
                    <p class="text-sm text-slate-400" data-translate="todaysTarget">Today's Target</p>
                    <p id="target-count" class="text-4xl font-bold text-green-400">14</p>
                </div>
                <div class="bg-slate-800 p-4 rounded-xl">
                    <p class="text-sm text-slate-400" data-translate="smokedToday">Smoked Today</p>
                    <p id="smoked-count" class="text-4xl font-bold text-amber-400">0</p>
                </div>
            </div>

            <!-- Action Button -->
            <button id="smoked-button" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-lg text-lg mb-6 transition-transform transform hover:scale-105 shadow-lg" data-translate="smokedButton">I Smoked a Cigarette</button>

            <!-- Time Limit Message -->
            <div id="time-limit-message" class="hidden text-center bg-slate-800 p-3 rounded-lg mb-6">
                <p class="font-semibold text-amber-400" data-translate="limitReached">You've reached your limit for today.</p>
                <p class="text-sm text-slate-400" data-translate="limitReachedSub">Your next cigarette is available tomorrow. You can do this!</p>
            </div>

            <!-- Progress Log -->
            <div class="flex-grow bg-slate-800 rounded-xl p-4 overflow-y-auto">
                <h3 class="text-lg font-bold mb-4" data-translate="progressLogTitle">Progress Log</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-400 uppercase">
                            <tr>
                                <th scope="col" class="py-3 px-2" data-translate="dateHeader">Date</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="targetHeader">Target</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="smokedHeader">Smoked</th>
                                <th scope="col" class="py-3 px-2 text-center" data-translate="statusHeader">Status</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table-body">
                            <!-- Rows will be injected by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
             <!-- Identity Quote -->
            <div class="mt-6 text-center bg-slate-800 p-4 rounded-xl border-l-4 border-cyan-400">
                <p class="text-sm text-slate-300 italic" data-translate="identityQuote">
                    "Most self-control problems are identity problems. It's easier to stop smoking when you see yourself as a non-smoker, than as a smoker trying to quit."
                </p>
            </div>
        </div>
        
        <!-- Congratulations Screen -->
        <div id="congrats-screen" class="hidden flex-grow flex flex-col justify-center items-center text-center p-4">
             <div class="text-7xl mb-4">üéâ</div>
             <h2 class="text-4xl font-bold text-green-400 mb-2" data-translate="congratsTitle">Congratulations!</h2>
             <p class="text-slate-300 mb-8" data-translate="congratsSubtitle">You have completed your journey and are now smoke-free! We are proud of you.</p>
             <button id="restart-journey-button" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-3 px-4 rounded-lg" data-translate="restartButton">Start a New Journey</button>
        </div>

    </div>

    <!-- Modals -->
    <!-- Mindfulness/Intervention Modal -->
    <div id="mindfulness-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto modal-content transform scale-95">
            <div id="mindfulness-phase-1">
                <h3 class="text-xl font-bold mb-4 text-amber-400" data-translate="mindfulnessPhase1Title">Before you smoke...</h3>
                <p class="text-slate-300 mb-6" data-translate="mindfulnessPhase1Text">Take a moment. Can you wait just 5 minutes? Try a glass of water or a few deep breaths first. This craving will pass.</p>
                <button id="mindfulness-continue-1" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="mindfulnessContinueButton">Continue</button>
            </div>
            <div id="mindfulness-phase-2" class="hidden">
                <h3 class="text-xl font-bold mb-4 text-amber-400" data-translate="mindfulnessPhase2Title">As you smoke...</h3>
                <p class="text-slate-300 mb-6" data-translate="mindfulnessPhase2Text">Notice the first 2-3 puffs. What do you truly feel? Is it pleasant? Think about the chemicals entering your body.</p>
                 <button id="mindfulness-continue-2" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="mindfulnessContinueButton">Continue</button>
            </div>
            <div id="mindfulness-phase-3" class="hidden">
                <h3 class="text-xl font-bold mb-4 text-amber-400" data-translate="mindfulnessPhase3Title">After you smoke...</h3>
                <p class="text-slate-300 mb-4" data-translate="mindfulnessPhase3Text">What did you gain? If it was a feeling of relaxation, acknowledge it.</p>
                <p class="bg-slate-700 p-3 rounded-lg text-slate-300 text-sm mb-6" data-translate="mindfulnessPhase3Insight">That feeling is normal. But remember, a cigarette is not the only way to relax. Let's find healthier ways together.</p>
                <button onclick="closeModal('mindfulness-modal')" class="w-full bg-slate-600 hover:bg-slate-700 font-bold py-2 px-4 rounded-lg" data-translate="mindfulnessCloseButton">I Understand</button>
            </div>
        </div>
    </div>
    
    <!-- Motivation Modal -->
    <div id="motivation-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm mx-auto text-center modal-content transform scale-95">
             <div class="text-5xl mb-4">üåü</div>
            <h3 class="text-xl font-bold mb-4 text-green-400" data-translate="motivationTitle">Great Job Yesterday!</h3>
            <p id="motivation-quote" class="text-slate-300 italic mb-6">"The secret of getting ahead is getting started."</p>
            <button onclick="closeModal('motivation-modal')" class="w-full bg-cyan-500 hover:bg-cyan-600 text-slate-900 font-bold py-2 px-4 rounded-lg" data-translate="motivationKeepGoingButton">Keep Going!</button>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const appContainer = document.getElementById('app-container');
        const setupScreen = document.getElementById('setup-screen');
        const mainScreen = document.getElementById('main-screen');
        const congratsScreen = document.getElementById('congrats-screen');
        const setupForm = document.getElementById('setup-form');
        const initialCigarettesInput = document.getElementById('initial-cigarettes');
        const languageSwitcher = document.getElementById('language-switcher');
        const targetCountEl = document.getElementById('target-count');
        const smokedCountEl = document.getElementById('smoked-count');
        const smokedButton = document.getElementById('smoked-button');
        const timeLimitMessage = document.getElementById('time-limit-message');
        const progressTableBody = document.getElementById('progress-table-body');
        const headerResetButton = document.getElementById('header-reset-button');
        const restartJourneyButton = document.getElementById('restart-journey-button');
        
        // Modals
        const mindfulnessModal = document.getElementById('mindfulness-modal');
        const mindfulnessPhase1 = document.getElementById('mindfulness-phase-1');
        const mindfulnessPhase2 = document.getElementById('mindfulness-phase-2');
        const mindfulnessPhase3 = document.getElementById('mindfulness-phase-3');
        const mindfulnessContinue1 = document.getElementById('mindfulness-continue-1');
        const mindfulnessContinue2 = document.getElementById('mindfulness-continue-2');
        const motivationModal = document.getElementById('motivation-modal');
        const motivationQuoteEl = document.getElementById('motivation-quote');

        // --- App State ---
        let state = {
            language: 'en',
            plan: [],
            startDate: null,
            initialCount: 0,
            lastCheckedDate: null
        };
        
        // --- Translations & Quotes ---
        const translations = {
            en: {
                appTitle: "Smoke-Free Journey",
                welcomeTitle: "Welcome!",
                welcomeSubtitle: "Let's start your journey to a smoke-free life.",
                initialCigarettesLabel: "How many cigarettes do you smoke per day?",
                startButton: "Start Journey",
                todaysTarget: "Today's Target",
                smokedToday: "Smoked Today",
                smokedButton: "I Smoked a Cigarette",
                limitReached: "You've reached your limit for today.",
                limitReachedSub: "Your next cigarette is available tomorrow. You can do this!",
                progressLogTitle: "Progress Log",
                dateHeader: "Date",
                targetHeader: "Target",
                smokedHeader: "Smoked",
                statusHeader: "Status",
                resetButton: "Start Over",
                mindfulnessPhase1Title: "Before you smoke...",
                mindfulnessPhase1Text: "Take a moment. Can you wait just 5 minutes? Try a glass of water or a few deep breaths first. This craving will pass.",
                mindfulnessContinueButton: "Continue",
                mindfulnessPhase2Title: "As you smoke...",
                mindfulnessPhase2Text: "Notice the first 2-3 puffs. What do you truly feel? Is it pleasant? Think about the chemicals entering your body.",
                mindfulnessPhase3Title: "After you smoke...",
                mindfulnessPhase3Text: "What did you gain? If it was a feeling of relaxation, acknowledge it.",
                mindfulnessPhase3Insight: "That feeling is normal. But remember, a cigarette is not the only way to relax. Let's find healthier ways together.",
                mindfulnessCloseButton: "I Understand",
                motivationTitle: "Great Job Yesterday!",
                motivationKeepGoingButton: "Keep Going!",
                congratsTitle: "Congratulations!",
                congratsSubtitle: "You have completed your journey and are now smoke-free! We are proud of you.",
                restartButton: "Start a New Journey",
                identityQuote: "Most self-control problems are identity problems. It's easier to stop smoking when you see yourself as a non-smoker, rather than as a smoker 'trying to quit'.",
                statusPass: "Pass",
                statusFail: "Fail",
                statusPending: "Pending"
            },
            ta: {
                appTitle: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§ ‡Æ™‡ÆØ‡Æ£‡ÆÆ‡Øç",
                welcomeTitle: "‡Æµ‡Ææ‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!",
                welcomeSubtitle: "‡Æ™‡ØÅ‡Æï‡Øà‡ÆØ‡Æ±‡Øç‡Æ± ‡Æµ‡Ææ‡Æ¥‡Øç‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æ®‡Øã‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ‡Æµ‡Øã‡ÆÆ‡Øç.",
                initialCigarettesLabel: "‡Æí‡Æ∞‡ØÅ ‡Æ®‡Ææ‡Æ≥‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æé‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æö‡Æø‡Æï‡Æ∞‡ØÜ‡Æü‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æï‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç?",
                startButton: "‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
                todaysTarget: "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ",
                smokedToday: "‡Æá‡Æ©‡Øç‡Æ±‡ØÅ ‡Æ™‡ØÅ‡Æï‡Øà‡Æ§‡Øç‡Æ§‡Æ§‡ØÅ",
                smokedButton: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æö‡Æø‡Æï‡Æ∞‡ØÜ‡Æü‡Øç ‡Æ™‡Æø‡Æü‡Æø‡Æ§‡Øç‡Æ§‡Øá‡Æ©‡Øç",
                limitReached: "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æµ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Øà ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æü‡Øà‡Æ®‡Øç‡Æ§‡ØÅ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç.",
                limitReachedSub: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æö‡Æø‡Æï‡Æ∞‡ØÜ‡Æü‡Øç ‡Æ®‡Ææ‡Æ≥‡Øà ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Ææ‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç!",
                progressLogTitle: "‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡Øç‡Æ±‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ",
                dateHeader: "‡Æ§‡Øá‡Æ§‡Æø",
                targetHeader: "‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ",
                smokedHeader: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ§‡Øç‡Æ§‡Æ§‡ØÅ",
                statusHeader: "‡Æ®‡Æø‡Æ≤‡Øà",
                resetButton: "‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
                mindfulnessPhase1Title: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡Æ©‡Øç...",
                mindfulnessPhase1Text: "‡Æí‡Æ∞‡ØÅ ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡ÆÆ‡Øç. 5 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Ææ? ‡Æí‡Æ∞‡ØÅ ‡Æï‡Æø‡Æ≥‡Ææ‡Æ∏‡Øç ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æö‡Æø‡Æ≤ ‡ÆÜ‡Æ¥‡Øç‡Æ®‡Øç‡Æ§ ‡Æö‡ØÅ‡Æµ‡Ææ‡Æö‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç. ‡Æá‡Æ®‡Øç‡Æ§ ‡Æè‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æï‡Æü‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Øã‡Æï‡ØÅ‡ÆÆ‡Øç.",
                mindfulnessContinueButton: "‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æï",
                mindfulnessPhase2Title: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ...",
                mindfulnessPhase2Text: "‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç 2-3 ‡Æ™‡ØÅ‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡Æï‡Æµ‡Æ©‡Æø‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ£‡Øç‡ÆÆ‡Øà‡ÆØ‡Æø‡Æ≤‡Øá‡ÆØ‡Øá ‡Æé‡Æ©‡Øç‡Æ© ‡Æâ‡Æ£‡Æ∞‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç? ‡ÆÖ‡Æ§‡ØÅ ‡Æá‡Æ©‡Æø‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ©‡Æ§‡Ææ? ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æü‡Æ≤‡Æø‡Æ≤‡Øç ‡Æ®‡ØÅ‡Æ¥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ∞‡Æö‡Ææ‡ÆØ‡Æ©‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æö‡Æø‡Æ®‡Øç‡Æ§‡Æø‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
                mindfulnessPhase3Title: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æ§‡Øç‡Æ§ ‡Æ™‡Æø‡Æ±‡Æï‡ØÅ...",
                mindfulnessPhase3Text: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æ©‡Øç‡Æ© ‡Æ™‡ØÜ‡Æ±‡Øç‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç? ‡ÆÖ‡Æ§‡ØÅ ‡Æì‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æâ‡Æ£‡Æ∞‡Øç‡Æµ‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç, ‡ÆÖ‡Æ§‡Øà ‡Æí‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
                mindfulnessPhase3Insight: "‡ÆÖ‡Æ®‡Øç‡Æ§ ‡Æâ‡Æ£‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æá‡ÆØ‡Æ≤‡Øç‡Æ™‡Ææ‡Æ©‡Æ§‡ØÅ. ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡Æø‡Æ≤‡Øç ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æì‡ÆØ‡Øç‡Æµ‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡Æö‡Æø‡Æï‡Æ∞‡ØÜ‡Æü‡Øç ‡Æí‡Æ∞‡Øá ‡Æµ‡Æ¥‡Æø ‡ÆÖ‡Æ≤‡Øç‡Æ≤. ‡ÆÜ‡Æ∞‡Øã‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Ææ‡Æ© ‡Æµ‡Æ¥‡Æø‡Æï‡Æ≥‡Øà ‡Æí‡Æ©‡Øç‡Æ±‡Ææ‡Æï‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Øã‡ÆÆ‡Øç.",
                mindfulnessCloseButton: "‡Æé‡Æ©‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡ØÅ‡Æ∞‡Æø‡Æï‡Æø‡Æ±‡Æ§‡ØÅ",
                motivationTitle: "‡Æ®‡Øá‡Æ±‡Øç‡Æ±‡ØÅ ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡Ææ‡Æï ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç!",
                motivationKeepGoingButton: "‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡ØÅ!",
                congratsTitle: "‡Æµ‡Ææ‡Æ¥‡Øç‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Æ≥‡Øç!",
                congratsSubtitle: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Øà ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç, ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡Æµ‡Æ∞‡Øç! ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ®‡Ææ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ØÜ‡Æ∞‡ØÅ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç.",
                restartButton: "‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æ™‡ÆØ‡Æ£‡Æ§‡Øç‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
                identityQuote: "‡Æ™‡ØÜ‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Ææ‡Æ≤‡Ææ‡Æ© ‡Æö‡ØÅ‡ÆØ‡Æï‡Øç‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡ØÅ‡Æö‡Øç ‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡Æö‡Øç ‡Æö‡Æø‡Æï‡Øç‡Æï‡Æ≤‡Øç‡Æï‡Æ≥‡Øá. '‡Æµ‡Æø‡Æü ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç' ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æµ‡Æ∞‡Ææ‡Æï ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æ§‡Øà ‡Æµ‡Æø‡Æü, ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡Æµ‡Æ∞‡Ææ‡Æï ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æ§‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ§‡ØÅ ‡Æé‡Æ≥‡Æø‡Æ§‡ØÅ.",
                statusPass: "‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø",
                statusFail: "‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø",
                statusPending: "‡Æ®‡Æø‡Æ≤‡ØÅ‡Æµ‡Øà‡ÆØ‡Æø‡Æ≤‡Øç"
            }
        };

        const quotes = {
            en: [
                "Believe you can and you're halfway there.", "The first step to getting anywhere is deciding you're not going to stay where you are.", "It does not matter how slowly you go as long as you do not stop.", "Success is the sum of small efforts, repeated day in and day out.", "The only person you are destined to become is the person you decide to be."
            ],
            ta: [
                "‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æé‡Æ©‡Øç‡Æ±‡ØÅ ‡Æ®‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ§‡Æø ‡Æ§‡ØÇ‡Æ∞‡ÆÆ‡Øç ‡Æï‡Æü‡Æ®‡Øç‡Æ§‡ØÅ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç.", "‡Æé‡Æô‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æµ‡Æ§‡Æ±‡Øç‡Æï‡Ææ‡Æ© ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç ‡Æ™‡Æü‡Æø, ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç ‡Æ™‡Øã‡Æµ‡Æ§‡Æø‡Æ≤‡Øç‡Æ≤‡Øà ‡Æé‡Æ©‡Øç‡Æ±‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æµ‡Æ§‡Øá.", "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Ææ‡Æ§ ‡Æµ‡Æ∞‡Øà ‡Æé‡Æµ‡Øç‡Æµ‡Æ≥‡Æµ‡ØÅ ‡ÆÆ‡ØÜ‡Æ§‡ØÅ‡Æµ‡Ææ‡Æï‡Æö‡Øç ‡Æö‡ØÜ‡Æ©‡Øç‡Æ±‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æ∞‡Æµ‡Ææ‡ÆØ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.", "‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡ØÅ ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æö‡Æø‡Æ±‡ØÅ ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Æ≥‡Æø‡Æ©‡Øç ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Øä‡Æï‡Øà.", "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æé‡Æ©‡Øç‡Æ±‡ØÅ ‡Æµ‡Æø‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æí‡Æ∞‡Øá ‡Æ®‡Æ™‡Æ∞‡Øç, ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æ™‡Æ∞‡Øá."
            ]
        };

        // --- Core Functions ---

        /**
         * Initializes the application, loads state, and sets up initial view.
         */
        function init() {
            loadState();
            updateUIForLanguage();
            
            if (state.plan.length > 0) {
                const finalDay = state.plan[state.plan.length -1];
                if(finalDay.target === 0 && finalDay.status === 'Pass'){
                    showScreen('congrats');
                } else {
                    showScreen('main');
                    render();
                    checkDailyStatus();
                }
            } else {
                showScreen('setup');
            }
            
            setupEventListeners();
        }

        /**
         * Sets up all the event listeners for the application.
         */
        function setupEventListeners() {
            languageSwitcher.addEventListener('click', toggleLanguage);
            setupForm.addEventListener('submit', startJourney);
            smokedButton.addEventListener('click', handleSmokedClick);
            headerResetButton.addEventListener('click', resetJourney);
            restartJourneyButton.addEventListener('click', resetJourney);

            // Mindfulness modal flow
            mindfulnessContinue1.addEventListener('click', () => {
                mindfulnessPhase1.classList.add('hidden');
                mindfulnessPhase2.classList.remove('hidden');
            });
             mindfulnessContinue2.addEventListener('click', () => {
                mindfulnessPhase2.classList.add('hidden');
                mindfulnessPhase3.classList.remove('hidden');
            });
        }
        
        /**
         * Switches the application language between English and Tamil.
         */
        function toggleLanguage() {
            state.language = state.language === 'en' ? 'ta' : 'en';
            saveState();
            updateUIForLanguage();
            if (state.plan.length > 0) {
                renderTable(); // Re-render table for status text
            }
        }
        
        /**
         * Updates all UI text elements based on the current language.
         */
        function updateUIForLanguage() {
            languageSwitcher.textContent = state.language === 'en' ? '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' : 'English';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[state.language][key]) {
                    el.textContent = translations[state.language][key];
                }
            });
        }

        /**
         * Handles the initial setup form submission.
         * @param {Event} e The form submission event.
         */
        function startJourney(e) {
            e.preventDefault();
            const count = parseInt(initialCigarettesInput.value);
            if (count > 0) {
                state.initialCount = count;
                state.startDate = getTodayDateString();
                state.lastCheckedDate = getYesterdayDateString(); // To trigger motivation on first day
                generatePlan();
                saveState();
                showScreen('main');
                render();
            }
        }

        /**
         * Generates the entire smoking reduction plan.
         */
        function generatePlan() {
            state.plan = [];
            let currentTarget = state.initialCount;
            let currentDate = new Date();
            let weekCounter = 0;
            
            while(currentTarget > 0) {
                const weekNumber = Math.floor(weekCounter / 7);
                const dailyTarget = Math.max(0, state.initialCount - 1 - weekNumber);
                
                state.plan.push({
                    date: toISODateString(currentDate),
                    target: dailyTarget,
                    smoked: 0,
                    status: 'Pending' // Pending, Pass, Fail
                });

                if (dailyTarget === 0) break;

                currentDate.setDate(currentDate.getDate() + 1);
                weekCounter++;
            }
        }

        /**
         * Handles the click event for the "I Smoked" button.
         */
        function handleSmokedClick() {
            const todayEntry = getTodayEntry();
            if (todayEntry) {
                if(todayEntry.smoked < todayEntry.target) {
                    showMindfulnessModal(); // Show intervention before incrementing
                    todayEntry.smoked += 1;
                    saveState();
                    render();
                } 
            }
        }

        /**
         * Renders all dynamic parts of the main screen.
         */
        function render() {
            renderDashboard();
            renderTable();
        }

        /**
         * Updates the dashboard with today's counts.
         */
        function renderDashboard() {
            const todayEntry = getTodayEntry();
            if (todayEntry) {
                targetCountEl.textContent = todayEntry.target;
                smokedCountEl.textContent = todayEntry.smoked;
                
                if (todayEntry.smoked >= todayEntry.target) {
                    smokedButton.disabled = true;
                    smokedButton.classList.add('opacity-50', 'cursor-not-allowed');
                    timeLimitMessage.classList.remove('hidden');
                } else {
                    smokedButton.disabled = false;
                    smokedButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    timeLimitMessage.classList.add('hidden');
                }
            } else {
                 // Plan is over or something is wrong
                targetCountEl.textContent = '0';
                smokedCountEl.textContent = '0';
                smokedButton.disabled = true;
                smokedButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        /**
         * Renders the progress log table.
         */
        function renderTable() {
            progressTableBody.innerHTML = '';
            const todayStr = getTodayDateString();
            state.plan.forEach(day => {
                const isToday = day.date === todayStr;
                const rowClass = isToday ? 'bg-slate-700 font-bold' : '';
                
                let statusClass = '';
                let statusText = translations[state.language].statusPending || 'Pending';
                
                if (day.status === 'Pass') {
                    statusClass = 'text-green-400';
                    statusText = translations[state.language].statusPass || 'Pass';
                } else if (day.status === 'Fail') {
                    statusClass = 'text-red-400';
                    statusText = translations[state.language].statusFail || 'Fail';
                }

                const row = `
                    <tr class="${rowClass}">
                        <td class="py-3 px-2">${formatDate(day.date)}</td>
                        <td class="py-3 px-2 text-center">${day.target}</td>
                        <td class="py-3 px-2 text-center">${day.smoked}</td>
                        <td class="py-3 px-2 text-center font-semibold ${statusClass}">${statusText}</td>
                    </tr>
                `;
                progressTableBody.innerHTML += row;
            });
        }
        
        /**
         * Checks the status of previous days and shows motivation if applicable.
         */
        function checkDailyStatus() {
            const todayStr = getTodayDateString();
            if(state.lastCheckedDate === todayStr) return; // Already checked today
            
            let showMotivation = false;
            
            state.plan.forEach(day => {
                // Check and update status for all days before today
                if (day.date < todayStr && day.status === 'Pending') {
                    day.status = day.smoked <= day.target ? 'Pass' : 'Fail';
                    if (day.date === getYesterdayDateString() && day.status === 'Pass') {
                        showMotivation = true;
                    }
                }
            });

            if (showMotivation) {
                showMotivationModal();
            }

            state.lastCheckedDate = todayStr;
            saveState();
            renderTable();
        }


        /**
         * Resets the application to the initial setup screen.
         */
        function resetJourney() {
            if (confirm(state.language === 'en' ? 'Are you sure you want to start over? All your progress will be lost.' : '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ? ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øá‡Æ±‡Øç‡Æ±‡ÆÆ‡Øç ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æá‡Æ¥‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡ÆÆ‡Øç.')) {
                localStorage.removeItem('smokeFreeState');
                state = { language: state.language, plan: [], startDate: null, initialCount: 0, lastCheckedDate: null };
                initialCigarettesInput.value = '';
                showScreen('setup');
            }
        }

        // --- View & Modal Controls ---
        
        function showScreen(screenName) {
            setupScreen.classList.add('hidden');
            mainScreen.classList.add('hidden');
            congratsScreen.classList.add('hidden');

            if(screenName === 'setup') setupScreen.classList.remove('hidden');
            if(screenName === 'main') mainScreen.classList.remove('hidden');
            if(screenName === 'congrats') congratsScreen.classList.remove('hidden');
        }

        function showMindfulnessModal() {
            // Reset to phase 1
            mindfulnessPhase1.classList.remove('hidden');
            mindfulnessPhase2.classList.add('hidden');
            mindfulnessPhase3.classList.add('hidden');
            mindfulnessModal.classList.remove('hidden');
            mindfulnessModal.querySelector('.modal-content').classList.add('scale-100');
        }
        
        function showMotivationModal() {
            const langQuotes = quotes[state.language];
            const randomQuote = langQuotes[Math.floor(Math.random() * langQuotes.length)];
            motivationQuoteEl.textContent = `"${randomQuote}"`;
            motivationModal.classList.remove('hidden');
            motivationModal.querySelector('.modal-content').classList.add('scale-100');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('.modal-content').classList.remove('scale-100');
            modal.classList.add('hidden');
        }

        // --- Local Storage ---
        
        function saveState() {
            localStorage.setItem('smokeFreeState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('smokeFreeState');
            if (savedState) {
                state = JSON.parse(savedState);
            }
        }

        // --- Date Helpers ---

        function getTodayEntry() {
            const todayStr = getTodayDateString();
            return state.plan.find(day => day.date === todayStr);
        }
        
        function getTodayDateString() {
            return toISODateString(new Date());
        }
        
        function getYesterdayDateString() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            return toISODateString(yesterday);
        }

        function toISODateString(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { month: 'short', day: 'numeric' };
            return date.toLocaleDateString(state.language === 'ta' ? 'ta-IN' : 'en-US', options);
        }
        
        // --- Start the App ---
        init();
    </script>
</body>
</html>

